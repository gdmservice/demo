<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>GDM REPAIR SRL - Panou Admin</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f9fafb;
      margin: 0; padding: 30px;
      color: #333;
    }
    h1 {
      text-align: center; margin-bottom: 30px;
      color: #2c3e50;
    }
    .container {
      max-width: 900px; margin: 0 auto;
      background: white; padding: 25px 30px;
      border-radius: 10px;
      box-shadow: 0 4px 18px rgba(0,0,0,0.1);
    }
    label {
      display: block; margin-bottom: 8px;
      font-weight: 600;
      color: #34495e;
    }
    input[type="text"], select, textarea {
      width: 100%;
      padding: 10px 12px;
      font-size: 1rem;
      border-radius: 6px;
      border: 1.8px solid #d1d9e6;
      transition: border-color 0.3s ease;
    }
    input[type="text"]:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #2980b9;
      box-shadow: 0 0 8px #2980b9aa;
    }
    select {
      max-width: 300px; /* mai mic */
      cursor: pointer;
    }
    button {
      background-color: #2980b9;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 7px;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 15px;
      box-shadow: 0 4px 8px #2980b9aa;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover:not(:disabled) {
      background-color: #1f6391;
    }
    button:disabled {
      background-color: #9bbad6;
      cursor: not-allowed;
      box-shadow: none;
    }
    .detalii-client {
      margin-top: 25px;
      padding: 20px;
      background: #f0f4f9;
      border-radius: 10px;
      box-shadow: inset 0 0 10px #d3dbe9;
    }
    .detalii-client p {
      margin: 12px 0;
      font-size: 1.1rem;
      color: #2c3e50;
    }
    .detalii-client p b {
      display: inline-block;
      min-width: 140px;
      color: #34495e;
    }
    .piese-list ul {
      list-style: disc inside;
      padding-left: 10px;
      margin: 5px 0 0 0;
      color: #34495e;
    }
    .sms-box {
      background: #d1f1d1;
      padding: 15px;
      margin-top: 20px;
      border-radius: 8px;
      border: 1px solid #8ac38b;
      font-weight: 600;
      color: #2e7d32;
      box-shadow: 0 2px 6px #b6e1b6;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
      user-select: none;
    }
    #status-activ {
      position: fixed;
      top: 15px; right: 15px;
      background: #2980b9;
      color: white;
      padding: 15px 20px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 1rem;
      box-shadow: 0 0 15px #2980b9cc;
      max-width: 320px;
      text-align: center;
      z-index: 1100;
      user-select: none;
    }
    #cauta {
      max-width: 400px;
      margin-bottom: 20px;
      font-size: 1.1rem;
    }
    h3 {
      margin-top: 40px;
      margin-bottom: 15px;
      color: #34495e;
      border-bottom: 2px solid #2980b9;
      padding-bottom: 5px;
      user-select: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>GDM REPAIR SRL - Panou Admin</h1>

    <label for="cauta">Caută client (nume sau cod):</label>
    <input type="text" id="cauta" oninput="filtreazaClienti()" placeholder="Ex: Ion Popescu sau GDM1234" autocomplete="off" />

    <label for="clientSelect">Selectează client:</label>
    <select id="clientSelect" onchange="afiseazaClientSelectat()" aria-label="Select client">
      <option value="">-- Alege client --</option>
    </select>

    <div class="detalii-client" id="detalii-client" aria-live="polite" aria-atomic="true">
      <p><b>Nume:</b> <span id="detalii-nume">-</span></p>
      <p><b>Telefon:</b> <span id="detalii-telefon">-</span></p>
      <p><b>Utilaj:</b> <span id="detalii-utilaj">-</span></p>
      <p><b>Status:</b>
        <select id="detalii-status" style="max-width: 200px;">
          <option value="Diagnosticare">Diagnosticare</option>
          <option value="Reparat">Reparat</option>
          <option value="Nereparat">Nereparat</option>
          <option value="Nu se mai repară">Nu se mai repară</option>
        </select>
      </p>
      <p><b>Cod client:</b> <span id="detalii-cod">-</span></p>
      <p><b>Data aducerii:</b> <span id="detalii-data">-</span></p>
      <p><b>Reparație contra cost:</b> <span id="detalii-contraCost">Nu</span></p>
      <p><b>Preț:</b> <span id="detalii-pret">0 RON</span></p>
      <p><b>Piese schimbate:</b>
        <div class="piese-list" id="detalii-piese">Nicio piesă adăugată</div>
      </p>

      <button onclick="salveazaModificariClient()" disabled id="btnSalveaza" aria-disabled="true" title="Salvează modificările clientului">Salvează modificări</button>
      <button onclick="adaugaPiesaClient()" disabled id="btnAdaugaPiesa" aria-disabled="true" title="Adaugă piesă schimbată clientului">Adaugă piesă schimbată</button>
    </div>

    <h3>Adaugă client nou</h3>
    <label for="numeNou">Nume client:</label>
    <input type="text" id="numeNou" autocomplete="off" />

    <label for="telefonNou">Telefon:</label>
    <input type="text" id="telefonNou" autocomplete="off" />

    <label for="utilajNou">Utilaj:</label>
    <input type="text" id="utilajNou" placeholder="Ex: Motocoasă, Drujbă" autocomplete="off" />

    <label for="statusNou">Status:</label>
    <select id="statusNou">
      <option value="Diagnosticare">Diagnosticare</option>
      <option value="Reparat">Reparat</option>
      <option value="Nereparat">Nereparat</option>
      <option value="Nu se mai repară">Nu se mai repară</option>
    </select>

    <button onclick="adaugaClientNou()">Adaugă client nou</button>
  </div>

  <div id="status-activ" role="status" aria-live="polite">Status activ: Niciun client selectat</div>

  <script>
    let clienti = [];
    let counter = 1234;

    function incarcareClienti() {
      const data = localStorage.getItem('clientiGDM');
      if (data) {
        clienti = JSON.parse(data);
        if(clienti.length > 0){
          const lastCod = clienti[clienti.length -1].cod;
          const num = parseInt(lastCod.replace('GDM','')) + 1;
          if(!isNaN(num)) counter = num;
        }
      }
      sorteazaClienti();
      populateSelect();
    }

    function sorteazaClienti() {
      clienti.sort((a,b) => a.nume.localeCompare(b.nume));
    }

    function populateSelect(filtrat = null) {
      const select = document.getElementById('clientSelect');
      select.innerHTML = '<option value="">-- Alege client --</option>';
      let lista = filtrat || clienti;
      sorteazaClienti();

      lista.forEach(client => {
        const option = document.createElement('option');
        option.value = client.cod;
        option.textContent = `${client.nume} (${client.cod})`;
        select.appendChild(option);
      });
    }

    function afiseazaClientSelectat() {
      const cod = document.getElementById('clientSelect').value;
      if (!cod) {
        stergeDetalii();
        return;
      }

      const client = clienti.find(c => c.cod === cod);
      if(!client) {
        stergeDetalii();
        return;
      }

      document.getElementById('detalii-nume').textContent = client.nume;
      document.getElementById('detalii-telefon').textContent = client.telefon;
      document.getElementById('detalii-utilaj').textContent = client.utilaj;
      document.getElementById('detalii-status').value = client.status;
      document.getElementById('detalii-cod').textContent = client.cod;
      document.getElementById('detalii-data').textContent = client.dataOra;
      document.getElementById('detalii-contraCost').textContent = client.contraCost ? 'Da' : 'Nu';
      document.getElementById('detalii-pret').textContent = client.pret + ' RON';

      const pieseDiv = document.getElementById('detalii-piese');
      if(client.piese && client.piese.length > 0){
        let ul = '<ul>';
        client.piese.forEach(p => {
          ul += `<li>${p}</li>`;
        });
        ul += '</ul>';
        pieseDiv.innerHTML = ul;
      } else {
        pieseDiv.textContent = 'Nicio piesă adăugată';
      }

      // activează butoane
      document.getElementById('btnSalveaza').disabled = false;
      document.getElementById('btnSalveaza').setAttribute('aria-disabled', 'false');
      document.getElementById('btnAdaugaPiesa').disabled = false;
      document.getElementById('btnAdaugaPiesa').setAttribute('aria-disabled', 'false');

      document.getElementById('status-activ').textContent = `Status activ: Client selectat - ${client.nume}`;
    }

    function stergeDetalii() {
      document.getElementById('detalii-nume').textContent = '-';
      document.getElementById('detalii-telefon').textContent = '-';
      document.getElementById('detalii-utilaj').textContent = '-';
      document.getElementById('detalii-status').value = 'Diagnosticare';
      document.getElementById('detalii-cod').textContent = '-';
      document.getElementById('detalii-data').textContent = '-';
      document.getElementById('detalii-contraCost').textContent = 'Nu';
      document.getElementById('detalii-pret').textContent = '0 RON';
      document.getElementById('detalii-piese').textContent = 'Nicio piesă adăugată';

      document.getElementById('btnSalveaza').disabled = true;
      document.getElementById('btnSalveaza').setAttribute('aria-disabled', 'true');
      document.getElementById('btnAdaugaPiesa').disabled = true;
      document.getElementById('btnAdaugaPiesa').setAttribute('aria-disabled', 'true');

      document.getElementById('status-activ').textContent = 'Status activ: Niciun client selectat';
    }

    function adaugaClientNou() {
      const nume = document.getElementById('numeNou').value.trim();
      const telefon = document.getElementById('telefonNou').value.trim();
      const utilaj = document.getElementById('utilajNou').value.trim();
      const status = document.getElementById('statusNou').value;

      if(nume.length < 3){
        alert('Numele clientului trebuie să aibă cel puțin 3 caractere.');
        return;
      }
      if(telefon.length < 7){
        alert('Introduceți un telefon valid.');
        return;
      }
      if(utilaj.length < 2){
        alert('Introduceți utilajul clientului.');
        return;
      }

      const codClient = 'GDM' + counter++;
      const dataOra = new Date().toLocaleString('ro-RO');

      const clientNou = {
        nume,
        telefon,
        utilaj,
        status,
        cod: codClient,
        dataOra,
        contraCost: false,
        pret: 0,
        piese: []
      };

      clienti.push(clientNou);
      salveazaClientiInStorage();
      populateSelect();
      document.getElementById('clientSelect').value = codClient;
      afiseazaClientSelectat();

      // Curăță formularul de adăugare
      document.getElementById('numeNou').value = '';
      document.getElementById('telefonNou').value = '';
      document.getElementById('utilajNou').value = '';
      document.getElementById('statusNou').value = 'Diagnosticare';

      alert(`Clientul "${nume}" a fost adăugat cu codul ${codClient}.`);
    }

    function salveazaModificariClient() {
      const cod = document.getElementById('clientSelect').value;
      if (!cod) return alert('Selectați un client mai întâi.');

      const client = clienti.find(c => c.cod === cod);
      if(!client) return alert('Clientul nu a fost găsit.');

      const statusSelect = document.getElementById('detalii-status');
      const statusNou = statusSelect.value;

      // Dacă statusul este schimbat la "Reparat", întrebăm dacă este contra cost și cerem prețul
      if(client.status !== 'Reparat' && statusNou === 'Reparat') {
        const contra = confirm('Este reparația contra cost?');
        client.contraCost = contra;
        if(contra){
          let pretCorect = false;
          let pretNou = 0;
          while(!pretCorect){
            const inputPret = prompt('Introduceți prețul reparației în RON:', '0');
            if(inputPret === null){
              alert('Prețul nu a fost introdus. Operațiunea anulată.');
              return; // nu se salvează modificarea statusului
            }
            pretNou = Number(inputPret);
            if(!isNaN(pretNou) && pretNou >= 0){
              pretCorect = true;
            } else {
              alert('Introduceți un număr valid pentru preț.');
            }
          }
          client.pret = pretNou;
        } else {
          client.pret = 0;
        }
      }

      client.status = statusNou;

      salveazaClientiInStorage();
      afiseazaClientSelectat();
      trimiteSMS(client);
    }

    function trimiteSMS(client) {
      // Simulare trimitere SMS (aici poți integra API real)
      const smsText = `Salut ${client.nume}, utilajul tău (${client.utilaj}) este acum cu status: ${client.status}.`;
      afiseazaMesajSMS(smsText);
    }

    function afiseazaMesajSMS(text) {
      // Șterge mesajul vechi dacă există
      let smsBox = document.querySelector('.sms-box');
      if(smsBox) smsBox.remove();

      smsBox = document.createElement('div');
      smsBox.className = 'sms-box';
      smsBox.textContent = `Mesaj trimis către client: ${text}`;

      document.body.appendChild(smsBox);

      // Mesaj dispare după 6 secunde
      setTimeout(() => {
        smsBox.remove();
      }, 6000);
    }

    function adaugaPiesaClient() {
      const cod = document.getElementById('clientSelect').value;
      if(!cod) return alert('Selectați un client pentru a adăuga piesă.');

      const piesa = prompt('Introduceți numele piesei schimbate:');
      if(piesa && piesa.trim().length > 1){
        const client = clienti.find(c => c.cod === cod);
        if(!client.piese) client.piese = [];
        client.piese.push(piesa.trim());
        salveazaClientiInStorage();
        afiseazaClientSelectat();
      }
    }

    function salveazaClientiInStorage() {
      localStorage.setItem('clientiGDM', JSON.stringify(clienti));
    }

    function filtreazaClienti() {
      const text = document.getElementById('cauta').value.toLowerCase();
      if(text.length < 2){
        populateSelect();
        return;
      }
      const filtrat = clienti.filter(c => c.nume.toLowerCase().includes(text) || c.cod.toLowerCase().includes(text));
      populateSelect(filtrat);
    }

    // Init
    incarcareClienti();
    stergeDetalii();
  </script>
</body>
</html>
