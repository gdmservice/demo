<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>GDM REPAIR SRL - Panou Admin</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    input, select, button, textarea { margin: 5px; padding: 8px; }
    .sms-box { background: #e0ffe0; padding: 10px; margin-top: 10px; border: 1px solid #b2d8b2; }
    .client-box { background: #fff; padding: 10px; margin-top: 10px; border: 1px solid #ccc; }
    #status-activ {
      position: fixed;
      top: 10px; right: 10px;
      background: #222; color: #fff;
      padding: 10px 15px;
      border-radius: 8px;
      font-weight: bold;
      box-shadow: 0 0 10px #0008;
      max-width: 300px;
      z-index: 1000;
    }
    .piese-list {
      background: #eef9ff; padding: 8px; margin-top: 8px; border: 1px solid #99ccff; max-width: 400px;
    }
  </style>
</head>
<body>
  <h1>GDM REPAIR SRL - Panou Admin</h1>

  <label>Caută client (nume sau cod): 
    <input type="text" id="cauta" oninput="filtreazaClienti()" placeholder="Ex: Ion Popescu sau GDM1234" style="width:300px;" />
  </label>

  <hr>

  <label> Selectează client: 
    <select id="clientSelect" onchange="afiseazaClientSelectat()" style="min-width: 250px;">
      <option value="">-- Alege client --</option>
    </select>
  </label><br>

  <div id="detalii-client" style="margin-top:15px; background:#fff; padding:15px; border:1px solid #ccc; max-width:400px;">
    <p><b>Nume:</b> <span id="detalii-nume">-</span></p>
    <p><b>Telefon:</b> <span id="detalii-telefon">-</span></p>
    <p><b>Utilaj:</b> <span id="detalii-utilaj">-</span></p>
    <p><b>Status:</b> 
      <select id="detalii-status" style="width: 150px;">
        <option value="Diagnosticare">Diagnosticare</option>
        <option value="Reparat">Reparat</option>
        <option value="Nereparat">Nereparat</option>
        <option value="Nu se mai repară">Nu se mai repară</option>
      </select>
    </p>
    <p><b>Cod client:</b> <span id="detalii-cod">-</span></p>
    <p><b>Data aducerii:</b> <span id="detalii-data">-</span></p>
    <p><b>Reparație contra cost:</b> <span id="detalii-contraCost">Nu</span></p>
    <p><b>Preț:</b> <span id="detalii-pret">0 RON</span></p>
    <p><b>Piese schimbate:</b> <div class="piese-list" id="detalii-piese">Nicio piesă adăugată</div></p>

    <button onclick="salveazaModificariClient()" disabled id="btnSalveaza">Salvează modificări</button>
    <button onclick="adaugaPiesaClient()" disabled id="btnAdaugaPiesa">Adaugă piesă schimbată</button>
  </div>

  <hr>

  <h3>Adaugă client nou</h3>
  <label>Nume client: <input type="text" id="numeNou" /></label><br />
  <label>Telefon: <input type="text" id="telefonNou" /></label><br />
  <label>Utilaj: <input type="text" id="utilajNou" placeholder="Ex: Motocoasă, Drujbă" /></label><br />
  <label>Status: 
    <select id="statusNou">
      <option value="Diagnosticare">Diagnosticare</option>
      <option value="Reparat">Reparat</option>
      <option value="Nereparat">Nereparat</option>
      <option value="Nu se mai repară">Nu se mai repară</option>
    </select>
  </label><br />
  <button onclick="adaugaClientNou()">Adaugă client nou</button>

  <div id="status-activ" style="margin-top:20px;">Status activ: Niciun client selectat</div>

  <script>
    let clienti = [];
    let counter = 1234;

    function incarcareClienti() {
      const data = localStorage.getItem('clientiGDM');
      if (data) {
        clienti = JSON.parse(data);
        if(clienti.length > 0){
          const lastCod = clienti[clienti.length -1].cod;
          const num = parseInt(lastCod.replace('GDM','')) + 1;
          if(!isNaN(num)) counter = num;
        }
      }
      sorteazaClienti();
      populateSelect();
    }

    function sorteazaClienti() {
      clienti.sort((a,b) => a.nume.localeCompare(b.nume));
    }

    function populateSelect(filtrat = null) {
      const select = document.getElementById('clientSelect');
      select.innerHTML = '<option value="">-- Alege client --</option>';
      let lista = filtrat || clienti;
      sorteazaClienti();

      lista.forEach(client => {
        const option = document.createElement('option');
        option.value = client.cod;
        option.textContent = `${client.nume} (${client.cod})`;
        select.appendChild(option);
      });
    }

    function afiseazaClientSelectat() {
      const cod = document.getElementById('clientSelect').value;
      if (!cod) {
        stergeDetalii();
        return;
      }

      const client = clienti.find(c => c.cod === cod);
      if(!client) {
        stergeDetalii();
        return;
      }

      // Populăm detaliile clientului
      document.getElementById('detalii-nume').textContent = client.nume;
      document.getElementById('detalii-telefon').textContent = client.telefon;
      document.getElementById('detalii-utilaj').textContent = client.utilaj;
      document.getElementById('detalii-status').value = client.status;
      document.getElementById('detalii-cod').textContent = client.cod;
      document.getElementById('detalii-data').textContent = client.dataOra;
      document.getElementById('detalii-contraCost').textContent = client.contraCost ? 'Da' : 'Nu';
      document.getElementById('detalii-pret').textContent = client.pret + ' RON';

      const pieseDiv = document.getElementById('detalii-piese');
      if(client.pieseSchimbate.length > 0){
        pieseDiv.innerHTML = '<ul>' + client.pieseSchimbate.map(p => `<li>${p}</li>`).join('') + '</ul>';
      } else {
        pieseDiv.textContent = 'Nicio piesă adăugată';
      }

      document.getElementById('btnSalveaza').disabled = false;
      document.getElementById('btnAdaugaPiesa').disabled = false;

      updateStatusActiv(client);
    }

    function stergeDetalii() {
      document.getElementById('detalii-nume').textContent = '-';
      document.getElementById('detalii-telefon').textContent = '-';
      document.getElementById('detalii-utilaj').textContent = '-';
      document.getElementById('detalii-status').value = 'Diagnosticare';
      document.getElementById('detalii-cod').textContent = '-';
      document.getElementById('detalii-data').textContent = '-';
      document.getElementById('detalii-contraCost').textContent = 'Nu';
      document.getElementById('detalii-pret').textContent = '0 RON';
      document.getElementById('detalii-piese').textContent = 'Nicio piesă adăugată';

      document.getElementById('btnSalveaza').disabled = true;
      document.getElementById('btnAdaugaPiesa').disabled = true;

      updateStatusActiv(null);
    }

    function salveazaModificariClient() {
      const cod = document.getElementById('detalii-cod').textContent;
      const client = clienti.find(c => c.cod === cod);
      if(!client) return alert('Clientul nu a fost găsit.');

      const statusNou = document.getElementById('detalii-status').value;

      if(client.status !== statusNou) {
        client.status = statusNou;

        if(statusNou === 'Reparat') {
          let contra = confirm("Reparația este contra cost?");
          if(contra) {
            let pret = prompt("Introdu prețul pentru reparație (ex: 250):", client.pret > 0 ? client.pret : '');
            pret = parseFloat(pret);
            if(isNaN(pret) || pret < 0) {
              alert("Preț invalid, se va seta 0.");
              pret = 0;
            }
            client.contraCost = true;
            client.pret = pret;
          } else {
            client.contraCost = false;
            client.pret = 0;
          }
        } else {
          client.contraCost = false;
          client.pret = 0;
        }

        salvareClienti();
        afiseazaClientSelectat();
        simuleazaSMS(client);
      } else {
        alert("Nu ați modificat statusul.");
      }
    }

    function adaugaPiesaClient() {
      const cod = document.getElementById('detalii-cod').textContent;
      const client = clienti.find(c => c.cod === cod);
      if(!client) return alert('Clientul nu a fost găsit.');

      let piesa = prompt(`Introdu denumirea piesei schimbate pentru ${client.nume}:`);
      if (piesa && piesa.trim() !== '') {
        client.pieseSchimbate.push(piesa.trim());
        salvareClienti();
        afiseazaClientSelectat();
      } else {
        alert('Denumire piesă invalidă.');
      }
    }

    function adaugaClientNou() {
      const nume = document.getElementById('numeNou').value.trim();
      const telefon = document.getElementById('telefonNou').value.trim();
      const utilaj = document.getElementById('utilajNou').value.trim();
      const status = document.getElementById('statusNou').value;

      if (!nume || !telefon || !utilaj) {
        alert('Completează toate câmpurile!');
        return;
      }

      const cod = 'GDM' + counter++;
      const dataOra = formatDataOra(new Date());

      const client = { nume, telefon, utilaj, status, cod, dataOra, contraCost: false, pret: 0, pieseSchimbate: [] };
      clienti.push(client);
      sorteazaClienti();
      salvareClienti();

      populateSelect();
      document.getElementById('clientSelect').value = client.cod;
      afiseazaClientSelectat();

      document.getElementById('numeNou').value = '';
      document.getElementById('telefonNou').value = '';
      document.getElementById('utilajNou').value = '';
      document.getElementById('statusNou').value = 'Diagnosticare';

      updateStatusActiv(client);
      simuleazaSMS(client);
    }

    function filtreazaClienti() {
      const val = document.getElementById('cauta').value.trim().toLowerCase();
      if (!val) {
        populateSelect();
        return;
      }
      const filtrati = clienti.filter(c => c.nume.toLowerCase().includes(val) || c.cod.toLowerCase().includes(val));
      populateSelect(filtrati);
    }

    function formatDataOra(date) {
      const zi = String(date.getDate()).padStart(2, '0');
      const luna = String(date.getMonth() + 1).padStart(2, '0');
      const an = date.getFullYear();
      const ora = String(date.getHours()).padStart(2, '0');
      const minut = String(date.getMinutes()).padStart(2, '0');
      return `${zi}.${luna}.${an}, ${ora}:${minut}`;
    }

    function salvareClienti() {
      localStorage.setItem('clientiGDM', JSON.stringify(clienti));
    }

    function simuleazaSMS(client) {
      let mesaj = `GDM REPAIR SRL: Utilajul ${client.utilaj} al clientului ${client.nume} are statusul: ${client.status}.`;
      if(client.status === 'Diagnosticare') {
        mesaj += ' Revenim cu diagnosticul.';
      } else if(client.status === 'Reparat') {
        mesaj += ' Reparația a fost finalizată.';
        if(client.contraCost) {
          mesaj += ` Costul este ${client.pret} RON. Vă rugăm să achitați.`;
        } else {
          mesaj += ' Serviciul este gratuit.';
        }
      } else if(client.status === 'Nereparat') {
        mesaj += ' Reparația nu a putut fi efectuată.';
      } else if(client.status === 'Nu se mai repară') {
        mesaj += ' Utilajul nu va mai fi reparat conform deciziei clientului.';
      }

      const smsBox = document.createElement('div');
      smsBox.className = 'sms-box';
      smsBox.textContent = `SMS trimis la ${client.telefon}: ${mesaj}`;
      document.body.appendChild(smsBox);
    }

    function updateStatusActiv(client) {
      const statusDiv = document.getElementById('status-activ');
      if(client){
        statusDiv.textContent = `Status activ: ${client.nume} - ${client.status}`;
      } else {
        statusDiv.textContent = 'Status activ: Niciun client selectat';
      }
    }

    window.onload = function() {
      incarcareClienti();
      stergeDetalii();
    }
  </script>
</body>
</html>
