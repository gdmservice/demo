<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>GDM REPAIR SRL - Panou Admin</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    input, select, button { margin: 5px; padding: 8px; }
    .sms-box { background: #e0ffe0; padding: 10px; margin-top: 10px; border: 1px solid #b2d8b2; }
    .client-box { background: #fff; padding: 10px; margin-top: 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>GDM REPAIR SRL - Panou Admin</h1>

  <label>Nume client: <input type="text" id="nume" /></label><br />
  <label>Telefon: <input type="text" id="telefon" /></label><br />
  <label>Utilaj: <input type="text" id="utilaj" placeholder="Ex: Motocoasă, Drujbă" /></label><br />
  <label>Status: 
    <select id="status">
      <option value="Diagnosticare">Diagnosticare</option>
      <option value="Reparat">Reparat</option>
      <option value="Nereparat">Nereparat</option>
      <option value="Nu se mai repară">Nu se mai repară</option>
    </select>
  </label><br />
  <button onclick="adaugaClient()">Adaugă client</button>

  <div id="clienti"></div>

  <script>
    let counter = 1234;
    let clienti = [];

    function incarcareClienti() {
      const data = localStorage.getItem('clientiGDM');
      if (data) {
        clienti = JSON.parse(data);
        if(clienti.length > 0){
          const lastCod = clienti[clienti.length -1].cod;
          const num = parseInt(lastCod.replace('GDM','')) + 1;
          if(!isNaN(num)) counter = num;
        }
      }
    }

    function salvareClienti() {
      localStorage.setItem('clientiGDM', JSON.stringify(clienti));
    }

    // Formatează data și ora în format DD.MM.YYYY, HH:MM
    function formatDataOra(date) {
      const zi = String(date.getDate()).padStart(2, '0');
      const luna = String(date.getMonth() + 1).padStart(2, '0');
      const an = date.getFullYear();
      const ora = String(date.getHours()).padStart(2, '0');
      const minut = String(date.getMinutes()).padStart(2, '0');
      return `${zi}.${luna}.${an}, ${ora}:${minut}`;
    }

    function adaugaClient() {
      const nume = document.getElementById('nume').value.trim();
      const telefon = document.getElementById('telefon').value.trim();
      const utilaj = document.getElementById('utilaj').value.trim();
      const status = document.getElementById('status').value;

      if (!nume || !telefon || !utilaj) {
        alert('Completează toate câmpurile');
        return;
      }

      const cod = 'GDM' + counter++;
      const dataOra = formatDataOra(new Date());

      const client = { nume, telefon, utilaj, status, cod, dataOra };
      clienti.push(client);
      salvareClienti();
      afiseazaClienti();
      simuleazaSMS(client);

      document.getElementById('nume').value = '';
      document.getElementById('telefon').value = '';
      document.getElementById('utilaj').value = '';
      document.getElementById('status').value = 'Diagnosticare';
    }

    function schimbaStatus(index) {
      const client = clienti[index];
      const optiuni = ['Diagnosticare', 'Reparat', 'Nereparat', 'Nu se mai repară'];
      let nouStatus = prompt(`Alege noul status pentru ${client.nume}:\n` + optiuni.join('\n'), client.status);
      if (nouStatus && optiuni.includes(nouStatus)) {
        client.status = nouStatus;
        salvareClienti();
        afiseazaClienti();
        simuleazaSMS(client);
      } else {
        alert('Status invalid sau modificare anulată');
      }
    }

    function simuleazaSMS(client) {
      let mesaj = `GDM REPAIR SRL: Utilajul ${client.utilaj} al clientului ${client.nume} are statusul: ${client.status}.`;
      if(client.status === 'Diagnosticare') {
        mesaj += ' Revenim cu diagnosticul.';
      } else if(client.status === 'Reparat') {
        mesaj += ' Reparația a fost finalizată. Vă rugăm să ridicați utilajul.';
      } else if(client.status === 'Nereparat') {
        mesaj += ' Reparația nu a putut fi efectuată.';
      } else if(client.status === 'Nu se mai repară') {
        mesaj += ' Utilajul nu va mai fi reparat conform deciziei clientului.';
      }

      const smsBox = document.createElement('div');
      smsBox.className = 'sms-box';
      smsBox.textContent = `SMS trimis la ${client.telefon}: ${mesaj}`;
      document.body.appendChild(smsBox);
    }

    function afiseazaClienti() {
      const container = document.getElementById('clienti');
      container.innerHTML = '';
      clienti.forEach((client, i) => {
        const box = document.createElement('div');
        box.className = 'client-box';
        box.innerHTML = `<strong>${client.nume}</strong> (${client.telefon})<br>
          Utilaj: ${client.utilaj}<br>
          Status: ${client.status}<br>
          Data aducerii: ${client.dataOra}<br>
          Cod client: ${client.cod}<br>
          <button onclick="schimbaStatus(${i})">Schimbă status</button>`;
        container.appendChild(box);
      });
    }

    window.onload = () => {
      incarcareClienti();
      afiseazaClienti();
    }
  </script>
</body>
</html>
